#!/bin/sh

main() {
  ansible_repo="https://github.com/bradleyfrank/bootstraps.git"
  dotfiles_dir="$HOME"/.dotfiles
  skip_tags=""

  while getopts ':wh' flag; do
    case "${flag}" in
      w) skip_tags="home_only" ;;
      h) skip_tags="work_only" ;;
      *) printf "%s\n" "Requires [-w|-h], aborting..." >&2 ; exit 1 ;;
    esac
  done

  if ansible-pull \
    --url "$ansible_repo" \
    --directory "$dotfiles_dir" \
    --only-if-changed \
    --skip-tags "$skip_tags" \
    playbooks/dotfiles.yml
  then
    exit 0
  else
    printf '%s\n' "Ansible run failed" >&2
    exit 1
  fi
}

main